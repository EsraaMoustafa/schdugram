(function(a){a.widget("role.b-multiUser",{options:{url:""},_create:function(){this.$list=this._elem("list");this.$accessList=this._elem("accessList");this.$addBlock=this._elem("addBlock");this.$popup=this._elem("popup");this.$deletePopup=this._elem("deletePopup");this._elem("addButton").click(this._proxy(function(){this._setMod(this.$addBlock,"open")}));this._elem("cancelButton").click(this._proxy(function(){this._delMod(this.$addBlock,"open")}));this._elem("editAccess").click(this._proxy(function(){var c=this.getActiveIds();var b=this._elem("modalEmail").val();var d={email:b,ids:c};var e=this;a.post(this.options.setAccessUrl,d).always(function(g){if(g.status=="ok"){e._delMod("error");e._setMod("success");e._elem("successMessage").text(g.data)}else{e._delMod("success");e._setMod("error");if(typeof g.message=="string"){e._elem("errorMessage").text(g.message)}else{for(var f in g.message){e._elem("errorMessage").text(g.message[f])}}}}).then(this._proxy(function(){this.$popup.modal("hide")})).done}));this._elem("deleteUserButton").click(this._proxy(function(){var b=this._elem("deleteModalEmail").val();var c={email:b};var d=this;a.post(this.options.deleteUserUrl,c).always(function(f){if(f.status=="ok"){d._delMod("error");d._setMod("success");d._elem("successMessage").text(f.data)}else{d._delMod("success");d._setMod("error");if(typeof f.message=="string"){d._elem("errorMessage").text(f.message)}else{for(var e in f.message){d._elem("errorMessage").text(f.message[e])}}}}).then(this._proxy(function(){this._reload();this.$deletePopup.modal("hide")})).done}));this.element.on("b-ajaxform:success",this._proxy(function(){this.element.find("form")["b-ajaxForm"]("reset");this._reload()}));this._reload();this.element.on("click","."+this._getElemClass("item"),this._proxy(function(c){var b=a(c.currentTarget);c.preventDefault();b.toggleClass("active")}));this.element.on("click","."+this._getElemClass("accessButton"),this._proxy(function(c){var b=this._elem("item").has(a(c.currentTarget));this._getAccess(b.data("email"))}));this.element.on("click","."+this._getElemClass("deleteButton"),this._proxy(function(c){var b=this._elem("item").has(a(c.currentTarget));this._showPopupDelete(b.data("email"))}))},_reload:function(){var b=this;a.get(this.options.url).then(function(c){b.$list.html(c.data)}).done()},_getAccess:function(b){var c=this;a.post(this.options.getAccessUrl,{email:b}).then(function(d){c.$accessList.html(d.data);c._showPopupEdit(b)}).done()},_removeItem:function(c){var b=this;a.post(this.options.removeUrl,{id:c}).then(function(){b._reload()}).done()},_getItems:function(){return this._elem("item")},getActiveIds:function(){var b=[];this._elem("item").filter(".active").filter(".accountIds").each(function(){b.push(a(this).data("id"))});return b},_showPopupEdit:function(b){this._elem("modalEmail").val(b);this.$popup.modal("show")},_showPopupDelete:function(b){this._elem("deleteModalEmail").val(b);this.$deletePopup.modal("show")}})})(jQuery);