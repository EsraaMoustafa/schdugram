(function(a){a.widget("role.b-ajaxForm",{_create:function(){this.element.roles();this.element.submit(this._proxy(function(b){b.preventDefault();this.disableSubmit();this._submit()}));this.$successMessage=this._elem("successMessage");this.$errorMessage=this._elem("errorMessage");this.element.find("input").on("input propertychange",this._proxy(function(b){this._hideError(a(b.currentTarget))}));this._hideErrors()},_submit:function(){var b=this.element;this._trigger(":ready");this._delMod("success");this._delMod("error");this._delMod(this.$successMessage,"show");this._hideErrors();this.disableSubmit();a.ajax(b.attr("action"),{data:b.serialize(),type:b.attr("method"),dataType:"json",success:this._proxy(function(c){switch(c.status){case"error":this._setMod("error");this._showErrors(c.message);this._trigger(":error",{},c.message);this.enableSubmit();break;case"ok":this._setMod("success");if("string"==a.type(c.data)){this.$successMessage.text(c.data);this._setMod(this.$successMessage,"show")}this._trigger(":success",{},c.data);this.enableSubmit();break;case"redirect":this.disableSubmit();document.location=c.url;break;default:this._errorLog("unknown ajax status, arguments: ",arguments)}}),error:this._proxy(function(){this.enableSubmit();this._trigger(":exception")}),complete:this._proxy(function(){this._trigger(":complete")})})},_hideErrors:function(){this._delMod(this.$errorMessage,"show");this.element.find("input").each(this._proxy(function(c,b){this._hideError(a(b))}))},_hideError:function(b){b.parents(".form-group").removeClass("has-error");if(b.data("error")){b.tooltip("destroy");b.data("error",false)}},_showErrors:function(e){if(typeof e==="string"){this.$errorMessage.text(e);this._setMod(this.$errorMessage,"show")}else{var d,b;for(var c in e){d=e[c];b=this.element.find("input[name="+c+"]");if(b.length){b.parents(".form-group").addClass("has-error");b.tooltip({title:d,placement:"right",delay:100,trigger:"manual"});b.tooltip("show");b.data("error",true)}else{this._showErrors(d)}}}},disableSubmit:function(){this._elem("submitButton").attr("disabled","disabled")},enableSubmit:function(){this._elem("submitButton").prop("disabled",false)},submit:function(){this._submit()},reset:function(){this._hideErrors();this._delMod("success");this._delMod("error");this.element.trigger("reset")}})})(jQuery);